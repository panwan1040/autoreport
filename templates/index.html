{% extends "layout.html" %}
{% block content %}
<div class="grid md:grid-cols-2 gap-6">
  <section class="p-4 bg-white rounded-xl shadow">
    <h2 class="font-semibold mb-3">สร้างโปรเจ็กต์ใหม่</h2>
    <form method="post" action="{{ url_for('create_project') }}" class="space-y-3">
      <input type="text" name="project_name" class="w-full border rounded p-2" placeholder="เช่น อาคาร 4 โครงสร้างชั้น 3" />
      <button class="bg-blue-600 text-white px-4 py-2 rounded">สร้าง</button>
    </form>
  </section>

  <section class="p-4 bg-white rounded-xl shadow">
    <h2 class="font-semibold mb-3">อัปโหลดรูป</h2>
    <form method="post" action="{{ url_for('upload') }}" enctype="multipart/form-data" class="space-y-3">
      <div>
        <label class="block text-sm text-gray-600 mb-1">เลือกโปรเจ็กต์ที่มี</label>
        <select name="project_select" class="w-full border rounded p-2">
          <option value="">-- เลือก --</option>
          {% for p in projects %}
            <option value="{{ p }}">{{ p }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label class="block text-sm text-gray-600 mb-1">หรือระบุโปรเจ็กต์ใหม่ทันที</label>
        <input name="project_manual" class="w-full border rounded p-2" placeholder="พิมพ์ชื่อโปรเจ็กต์"/>
      </div>
      <div class="grid grid-cols-2 gap-3">
        <div>
          <label class="block text-sm text-gray-600 mb-1">จุด (Point)</label>
          <input name="point" class="w-full border rounded p-2" placeholder="เช่น 1, 2, คาน-01"/>
        </div>
        <div>
          <label class="block text-sm text-gray-600 mb-1">ขั้นตอน (Step)</label>
          <select name="step" class="w-full border rounded p-2">
            <option value="">-- เลือกขั้นตอน --</option>
            {% for code, name in step_labels.items() %}
              <option value="{{ code }}">{{ name }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div>
        <label class="block text-sm text-gray-600 mb-1">เลือกรูป (เลือกได้หลายไฟล์)</label>
        <input type="file" name="photos" accept="image/*" multiple class="w-full border rounded p-2 bg-white"/>
      </div>
      <button class="bg-blue-600 text-white px-4 py-2 rounded">อัปโหลด</button>
    </form>
  </section>
</div>

<section class="p-4 bg-white rounded-xl shadow mt-6">
  <h2 class="font-semibold mb-3">สร้างรายงาน Word</h2>
  <form method="get" onsubmit="if(!this.project.value){alert('โปรดระบุโปรเจ็กต์');return false;}" action="" class="flex gap-3">
    <input name="project" class="border rounded p-2 flex-1" list="projlist" placeholder="พิมพ์ชื่อโปรเจ็กต์"/>
    <datalist id="projlist">
      {% for p in projects %}
        <option value="{{ p }}"></option>
      {% endfor %}
    </datalist>
    <a id="report_link" href="#" class="bg-green-600 text-white px-4 py-2 rounded" onclick="
      const proj=document.querySelector('input[name=project]').value.trim();
      if(!proj){alert('โปรดระบุโปรเจ็กต์');return;}
      window.location.href = '/report/' + encodeURIComponent(proj);
    ">ดาวน์โหลด .docx</a>
    <a id="browse_link" href="#" class="bg-gray-700 text-white px-4 py-2 rounded" onclick="
      const proj=document.querySelector('input[name=project]').value.trim();
      if(!proj){alert('โปรดระบุโปรเจ็กต์');return;}
      window.location.href = '/browse/' + encodeURIComponent(proj);
    ">ดูแกลเลอรี</a>
  </form>
</section>
{% endblock %}
